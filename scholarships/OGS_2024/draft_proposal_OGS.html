<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>draft_proposal_ogs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="draft_proposal_OGS_files/libs/clipboard/clipboard.min.js"></script>
<script src="draft_proposal_OGS_files/libs/quarto-html/quarto.js"></script>
<script src="draft_proposal_OGS_files/libs/quarto-html/popper.min.js"></script>
<script src="draft_proposal_OGS_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="draft_proposal_OGS_files/libs/quarto-html/anchor.min.js"></script>
<link href="draft_proposal_OGS_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="draft_proposal_OGS_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="draft_proposal_OGS_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="draft_proposal_OGS_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="draft_proposal_OGS_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="../../draft_proposal_OGS.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content page-columns page-full" id="quarto-document-content">




<p>Augustin Birot</p>
<p>Coping with climate change: Implications of a body mass increase<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> in yellow-bellied marmot over the last half century.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;shift is too vague since it can be either way</p></div></div><p>BACKGROUND: As a result of climate change, natural populations face rapid environmental variation with increased temperature, longer summers, and higher fluctuation from year to year making persistence more challenging than ever. Several key traits of species such as body mass and size are expected to change in relation to the new environmental conditions. Following Bergmann’s rule<span class="citation" data-cites="bergmannc1847"><sup><a href="#ref-bergmannc1847" role="doc-biblioref">1</a></sup></span>, body mass and size are expected to decrease with increasing temperature to facilitate heat dissipation<span class="citation" data-cites="daufresne2009 gardner_declining_2011"><sup><a href="#ref-daufresne2009" role="doc-biblioref">2</a>,<a href="#ref-gardner_declining_2011" role="doc-biblioref">3</a></sup></span>. However, body mass might also increase in response to global warming due to an increase in food availability or appearance of milder conditions<span class="citation" data-cites="guillemain2010 sheridan2011 yom-tov2008 ozgul_coupled_2010"><sup><a href="#ref-guillemain2010" role="doc-biblioref">4</a>–<a href="#ref-ozgul_coupled_2010" role="doc-biblioref">7</a></sup></span>. Furthermore, those changes in mass and size are expected to be correlated with a suite of behavioural and physiological traits and might aslo be associated with different survival and reproduction consequences <!--[not sure how the POLS fit here well without a lot more explanation]. --> The observed changes in traits with climate changes can be due to either evolution (<em>i.e.</em> changes in allele frequencies in response to selection, with younger individuals being better adapted to the new conditions) or phenotypic plasticity (<em>i.e.</em> genotype expressing different phenotypes depending on environmental conditions, or an individual adjusting to conditions within its life)<span class="citation" data-cites="charmantier_evolutionary_2014-1"><sup><a href="#ref-charmantier_evolutionary_2014-1" role="doc-biblioref">8</a></sup></span>. Knowing the importance and role of these two mechanisms in the observed changes in the traits of a species is key to understand the impact of climate changes and determine if and how a species can adapt to the new conditions. In Yellow-bellied marmots (<em>Marmota flaviventris</em>), a 10% increase in body mass over the past 50 years as been observed<span class="citation" data-cites="ozgul_coupled_2010"><sup><a href="#ref-ozgul_coupled_2010" role="doc-biblioref">7</a></sup></span> and was partly attributed to both evolution and plasticity. The reasons for such an increase and its consequences are however unclear.</p>
<p>STUDY SPECIES: Yellow-bellied marmots are ground-dwelling rodents inhabiting alpine habitats in western North America. They are active above ground for approximately a third of the year (May-September) during which they need to reproduce and accumulate enough fat to survive hibernation for the remainder of the time<span class="citation" data-cites="armitage2014"><sup><a href="#ref-armitage2014" role="doc-biblioref">9</a></sup></span>. The significant increased in body mass observed over the past 50 years has first been hypothesized to be caused simply by milder winters and longer active seasons due to climate change allowing to reach higher masses<span class="citation" data-cites="ozgul_coupled_2010"><sup><a href="#ref-ozgul_coupled_2010" role="doc-biblioref">7</a></sup></span>. However, recent works on the same population (my MSc thesis) showed a strong genetic change of body mass over time which is not expected under the previous hypothesis raising the need to reconsider the evolutionary scenario behind this shift. This study will be based on the long-term study of marmots in Colorado, USA, which started in 1962 and has followed over 5000 individuals from birth to death This study presents extensive data at the individual level including morphological, behavioural and physiological as well as survival, reproduction and genetic relatedness information</p>
<p>OBJECTIVES: My PhD will explore three important research questions (RQ).<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;running out of steam for this section since it is past 2300. also would be good to discuss since it is unclear what you mean</p></div></div><ul>
<li>RQ1: What are the mechanisms of this increase? So is it due to an increase in the individual baseline? An increase in growing capacity? Or both? I will assess that by estimating individual specific intercept and slopes for body mass through their lifetime to compare them through cohorts. Having strong variation in the intercept over time would indicate an increase of the individual baseline, and variation on the slopes represent an increase of their growing capacity.</li>
<li>RQ2: Which modification in the environment, over the years, could have triggered this shift? I will test the impact of various weather variables (measured at the study site since 1978) on the body mass in order to target precise factors. Then, I will test the effect of a combined variable (computed from principal component analysis) to check for a global weather effect on body mass.</li>
<li>RQ3: What are the implications of this change in body condition on marmots’ behavior, in line with the POLS? Using results from “flight initiation distance” experiment as a proxy of individual boldness<span class="citation" data-cites="ydenbergEconomicsFleeingPredators1986"><sup><a href="#ref-ydenbergEconomicsFleeingPredators1986" role="doc-biblioref">10</a></sup></span>, I will test the impact of body mass, over time, on individual boldness. Then, using “animal model” (i.e., mixed models assessing genetic variance from individual relatedness<span class="citation" data-cites="kruukEstimatingGeneticParameters2004"><sup><a href="#ref-kruukEstimatingGeneticParameters2004" role="doc-biblioref">11</a></sup></span>) I will test for variation of the individual’s boldness genetic value over time.</li>
</ul>
<p>SIGNIFICANCE: This research uses one of the most extensive natural population databases in the world to deepen our understanding of the genotype-phenotype-environment relationship. It will provide crucial insights into how wild populations adapt to changing environments. The project aims to illustrate the multimodal nature of both causes and consequences of this body mass increase, as we anticipate that no single hypothesis will fully explain the observed changes. Instead, we expect that each hypothesis will account for part of the process, either complementing or conflicting with one another. These findings will contribute valuable knowledge to both evolutionary biology and conservation biology, helping shape more effective conservation policies in the context of global climate change.</p>
<!-- ***Causes and consequences of the Yellow-Bellied Marmot's body mass shift in the last half century.***

**Background**: Natural selection shapes an organism's phenotype to optimize its fitness within its environment [@darwin_origin_1859]. When environmental conditions change, species typically respond in one of two ways: disperse or adapt [@charmantier_evolutionary_2014-1]. Adaptation occurs through **phenotypic plasticity**, where a genotype can express different phenotypes depending on environmental conditions, or **microevolution**, which involves shifts in allele frequencies within the population. While plasticity often provides a short-term solution, microevolution drives more permanent changes. Understanding how much each mechanism contributes to phenotypic changes is critical, especially in the context of climate change, where the consequences for populations could vary dramatically over time.

It is also crucial to understand that a Life-History Trait (LHT, i.e., a phenotypic trait that affects an individual's survival and reproduction) cannot evolve alone. Coevolution must be taken into account, and there is a growing need to conduct more multivariate analyses to understand evolutionary potential and identify potential constraints. This consideration is crucial to understand how a population can cope with environmental changes, particularly, again, in the context of climate change [@charmantier_evolutionary_2014; @gienappEvolutionaryDynamicsResponse2014].

Researchers have suggested that global warming could lead to a universal decrease in body size, in line with Bergmann's rule on heat dissipation [@bergmannc1847; @daufresne2009]. However, long-term evidence supporting this pattern is scarce [@gardner_declining_2011], and studies at higher latitudes have regularly produced contradictory findings [@guillemain2010; @yom-tov2008; @sheridan2011]. This contradictory pattern has been observed in a hibernating sciurid (Rodentia, Sciuridae), the Yellow-Bellied Marmots (YBM), *Marmota flaviventris*. A wild population in the Upper East River valley, Colorado, USA is the subject of the second longest-running wild mammal population studies in the world. It is also one of the most complete, with a tremendous quantity and variety of collected data. We have extensive data about marmot's life cycle, morphology, genetics, environment, etc. which allows for comprehensive analyses [more details in @armitage2014].

A significant body mass increase has been observed in this system during the last decades (1970s - 2010s). Initially, this was attributed to phenotypic plasticity resulting from milder environmental conditions and longer active season (i.e., spring/summer as marmots hibernates during the rest of the year) [@ozgul_coupled_2010]. However, recent work has raised questions about the use of **Integral Projection Model** [IPMs, i.e., a type of matrix projection model constructed on four major functions: survival, fecundity, development, and inheritance, @gonzalezIntegralProjectionModels2021] in making evolutionary inferences [@chevin_evolution_2015; @janeiro_towards_2017].

I reanalyzed this body mass shift, using quantitative genetic analysis, especially, **Animal Models**, which are a specific kind of mixed models. It uses a random individual effect linked with the population pedigree (i.e., parental links between each individual of the population) to decompose the phenotypic variance and estimates its genetic part [@kruukEstimatingGeneticParameters2004]. I worked in a Bayesian framework, using **MCMCglmms**, [@hadfield_mcmc_2010]. My preliminary research reveals a strong evolutionary signal alongside phenotypic plasticity. While the lengthening of the active season provides an ecological explanation for the observed plasticity, it does not account for the evolutionary changes. A longer active season should reduce selective pressure for larger body mass, as the death risks over hibernation would be lower. Thus, the aim of my PhD is to ***rethink the evolutionary drivers behind the observed body mass increase in the last half-century in a wild YBM population***. Then ***study the consequences of significant change in a LHT such as body mass in a hibernating species***.














**Research Questions (RQ) and Methods**: I will address two main research questions, each divided into several hypotheses with corresponding methodologies.

**RQ1**: *What are the causes of the observed body mass evolution?*

-   **Hypothesis 1**: Punctual extreme weather events have acted as selection bottlenecks, favoring heavier individuals in the population.

    -   **Methodology 1**: I will analyze extreme weather events occurrences at study sites and investigate their links with population fluctuations and mean body mass' genetic values over the study period.

-   **Hypothesis 2**: More frequent drought events, due to global warming, increase the proportion of dry vegetation, enhancing selection for larger individuals able to consume a more fibrous diet thanks to a longer Mean Retention Time (MRT) [@armitage2014].

    -   **Methodology 2**: I will study marmots' diet composition over the years to evaluate changes in vegetation quality and selection.

-   **Hypothesis 3**: Larger individuals will be favored by natural selection for their ability to fend off smaller predators such as Long-Tailed Weasels (*Mustela frenata*) and American Marten (*Martes americana*) [@armitage2014].

    -   **Methodology 3**: I will examine predators population dynamics and species composition and compare that to the recorded causes of marmot mortality over the study period.

**RQ2**: *What are the short- and long-term consequences of this LHT shift?*

-   **Hypothesis 4**: A significant shift in body mass, combined with environmental changes, will alter the life cycle of this hibernating species.

    -   **Methodology 4**: I will investigate changes in the active season/hibernation length balance and examine potential correlations with body mass and environmental factors.

-   **Hypothesis 5**: A shift in body condition will result in behavioral changes at the individual level.

    -   **Methodology 5**: I will assess changes in individual behavior by analyzing boldness data collected through Flight Initiation Distance (FID) experiments over the study period and test for links with body mass.

**Significance and Impact**: This research uses one of the most extensive natural population databases in the world to deepen our understanding of the genotype-phenotype-environment relationship. It will provide crucial insights into how wild populations adapt to changing environments. The project aims to illustrate the multimodal nature of both causes and consequences of this body mass increase, as we anticipate that no single hypothesis will fully explain the observed changes. Instead, we expect that each hypothesis will account for part of the process, either complementing or conflicting with one another. These findings will contribute valuable knowledge to the field of conservation biology, helping shape more effective conservation policies in the context of global climate change. -->
<div style="page-break-after: always;"></div>
<section id="references" class="level4">
<h4 class="anchored" data-anchor-id="references">References</h4>
<div class="{refs}">

</div>

</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-bergmannc1847" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Bergmann, C. About the relationships between heat conservation and body size of animals. <em>Goett Stud</em> <strong>1</strong>, (1847).</div>
</div>
<div id="ref-daufresne2009" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Daufresne, M., Lengfellner, K. &amp; Sommer, U. <a href="https://doi.org/10.1073/pnas.0902080106">Global warming benefits the small in aquatic ecosystems</a>. <em>Proceedings of the National Academy of Sciences</em> <strong>106</strong>, 12788–12793 (2009).</div>
</div>
<div id="ref-gardner_declining_2011" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Gardner, J. L., Peters, A., Kearney, M. R., Joseph, L. &amp; Heinsohn, R. <a href="https://doi.org/10.1016/j.tree.2011.03.005">Declining body size: A third universal response to warming?</a> <em>Trends in Ecology &amp; Evolution</em> <strong>26</strong>, 285–291 (2011).</div>
</div>
<div id="ref-guillemain2010" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Guillemain, M. <em>et al.</em> <a href="https://doi.org/10.1007/s13280-010-0020-9">Wintering French Mallard and Teal Are Heavier and in Better Body Condition than 30 Years Ago: Effects of a Changing Environment?</a> <em>AMBIO</em> <strong>39</strong>, 170–180 (2010).</div>
</div>
<div id="ref-sheridan2011" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Sheridan, J. A. &amp; Bickford, D. <a href="https://doi.org/10.1038/nclimate1259">Shrinking body size as an ecological response to climate change</a>. <em>Nature Climate Change</em> <strong>1</strong>, 401–406 (2011).</div>
</div>
<div id="ref-yom-tov2008" class="csl-entry" role="listitem">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Yom-Tov, Y., Yom-Tov, S. &amp; Jarrell, G. <a href="https://doi.org/10.1111/j.1095-8312.2007.00950.x">Recent increase in body size of the American marten Martes americana in Alaska: GLOBAL WARMING AND BODY SIZE OF THE AMERICAN MARTEN</a>. <em>Biological Journal of the Linnean Society</em> <strong>93</strong>, 701–707 (2008).</div>
</div>
<div id="ref-ozgul_coupled_2010" class="csl-entry" role="listitem">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">Ozgul, A. <em>et al.</em> <a href="https://doi.org/10.1038/nature09210">Coupled dynamics of body mass and population growth in response to environmental change</a>. <em>Nature</em> <strong>466</strong>, 482–485 (2010).</div>
</div>
<div id="ref-charmantier_evolutionary_2014-1" class="csl-entry" role="listitem">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Gienapp, P. &amp; Brommer, J. E. Evolutionary dynamics in response to climate change. in <em>Quantitative <span>Genetics</span> in the <span>Wild</span></em> (eds. Charmantier, A., Garant, D. &amp; Kruuk, L. E. B.) 254–274 (Oxford University PressOxford, 2014). doi:<a href="https://doi.org/10.1093/acprof:oso/9780199674237.003.0015">10.1093/acprof:oso/9780199674237.003.0015</a>.</div>
</div>
<div id="ref-armitage2014" class="csl-entry" role="listitem">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Armitage, K. B. Marmot biology. (2014) doi:<a href="https://doi.org/10.1017/cbo9781107284272">10.1017/cbo9781107284272</a>.</div>
</div>
<div id="ref-ydenbergEconomicsFleeingPredators1986" class="csl-entry" role="listitem">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Ydenberg, R. C. &amp; Dill, L. M. <a href="https://doi.org/10.1016/S0065-3454(08)60192-8">The <span>Economics</span> of <span>Fleeing</span> from <span>Predators</span></a>. in <em>Advances in the <span>Study</span> of <span>Behavior</span></em> vol. 16 229–249 (Elsevier, 1986).</div>
</div>
<div id="ref-kruukEstimatingGeneticParameters2004" class="csl-entry" role="listitem">
<div class="csl-left-margin">11. </div><div class="csl-right-inline">Kruuk, L. E. B. <a href="https://doi.org/10.1098/rstb.2003.1437">Estimating genetic parameters in natural populations using the <span>“animal model”</span></a>. <em>Philosophical Transactions of the Royal Society of London. Series B: Biological Sciences</em> <strong>359</strong>, 873–890 (2004).</div>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>