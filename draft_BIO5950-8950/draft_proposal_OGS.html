<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>draft_proposal_ogs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="draft_proposal_OGS_files/libs/clipboard/clipboard.min.js"></script>
<script src="draft_proposal_OGS_files/libs/quarto-html/quarto.js"></script>
<script src="draft_proposal_OGS_files/libs/quarto-html/popper.min.js"></script>
<script src="draft_proposal_OGS_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="draft_proposal_OGS_files/libs/quarto-html/anchor.min.js"></script>
<link href="draft_proposal_OGS_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="draft_proposal_OGS_files/libs/quarto-html/quarto-syntax-highlighting-79bb3942e891885f9f7af119cd221462.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="draft_proposal_OGS_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="draft_proposal_OGS_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="draft_proposal_OGS_files/libs/bootstrap/bootstrap-20142f88fe34e4b5635d880a375cfad7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="../draft_proposal_OGS.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">




<p>Augustin Birot</p>
<p><strong><em>Causes and consequences of the Yellow-Bellied Marmot’s body mass shift in the last half century.</em></strong></p>
<p><strong>Background</strong>: Natural selection shapes an organism’s phenotype to optimize its fitness within its environment <span class="citation" data-cites="darwin_origin_1859">(<a href="#ref-darwin_origin_1859" role="doc-biblioref">Darwin 1859</a>)</span>. When environmental conditions change, species typically respond in one of two ways: disperse or adapt <span class="citation" data-cites="charmantier_evolutionary_2014-1">(<a href="#ref-charmantier_evolutionary_2014-1" role="doc-biblioref">Gienapp and Brommer 2014</a>)</span>. Adaptation occurs through <strong>phenotypic plasticity</strong>, where a genotype can express different phenotypes depending on environmental conditions, or <strong>microevolution</strong>, which involves shifts in allele frequencies within the population. While plasticity often provides a short-term solution, microevolution drives more permanent changes. Understanding how much each mechanism contributes to phenotypic changes is critical, especially in the context of climate change, where the consequences for populations could vary dramatically over time.</p>
<p>Researchers have suggested that global warming could lead to a universal decrease in body size, in line with Bergmann’s rule on heat dissipation <span class="citation" data-cites="bergmannc1847 daufresne2009">(<a href="#ref-bergmannc1847" role="doc-biblioref">Bergmann, C 1847</a>; <a href="#ref-daufresne2009" role="doc-biblioref">Daufresne et al. 2009</a>)</span>. However, long-term evidence supporting this pattern is scarce <span class="citation" data-cites="gardner_declining_2011">(<a href="#ref-gardner_declining_2011" role="doc-biblioref">Gardner et al. 2011</a>)</span>, and studies at higher latitudes have regularly produced contradictory findings <span class="citation" data-cites="guillemain2010 yom-tov2008 sheridan2011">(<a href="#ref-guillemain2010" role="doc-biblioref">Guillemain et al. 2010</a>; <a href="#ref-sheridan2011" role="doc-biblioref">Sheridan and Bickford 2011</a>; <a href="#ref-yom-tov2008" role="doc-biblioref">Yom-Tov et al. 2008</a>)</span>. In Yellow-Bellied Marmots (YBM), <em>Marmota flaviventris</em>, which are the subject of one of the longest-running wild mammal population studies <span class="citation" data-cites="armitage2014">(more details in <a href="#ref-armitage2014" role="doc-biblioref">Armitage 2014</a>)</span>, we observe an increase in body mass in the last decades (1970s - 2010s). Initially, this shift was attributed to phenotypic plasticity resulting from milder environmental conditions and longer active season <span class="citation" data-cites="ozgul_coupled_2010">(<a href="#ref-ozgul_coupled_2010" role="doc-biblioref">Ozgul et al. 2010</a>)</span>.</p>
<p>However, recent work has raised question about the use of <strong>Integral Projection Model</strong> (IPMs) in making evolutionary inferences <span class="citation" data-cites="chevin_evolution_2015 janeiro_towards_2017">(<a href="#ref-chevin_evolution_2015" role="doc-biblioref">Chevin 2015</a>; <a href="#ref-janeiro_towards_2017" role="doc-biblioref">Janeiro et al. 2017</a>)</span>. My preliminary research, using quantitative genetic analysis, especially the <strong>Animal Model</strong>, in a Bayesian framework <span class="citation" data-cites="hadfield_mcmc_2010">(<strong>MCMCglmm</strong>, <a href="#ref-hadfield_mcmc_2010" role="doc-biblioref">Hadfield 2010</a>)</span>, reveals a strong evolutionary signal alongside phenotypic plasticity. While the lengthening of the active season provides an ecological explanation for the observed plasticity, it does not account for the evolutionary changes. A longer active season should reduce selective pressure for larger body mass. Thus, the aim of my PhD is to <strong><em>rethink the evolutionary drivers behind the observed body mass increase in the last half-century in a wild YBM population</em></strong>. Then <strong><em>study the consequences of significant change in a life-history trait such as body mass in a hibernating species</em></strong>.</p>
<p><strong>Research Questions (RQ) and Methods</strong>: I will address two main research questions, each divided into several hypotheses with corresponding methodologies.</p>
<p><strong>RQ1</strong>: <em>What are the causes of the observed body mass evolution?</em></p>
<ul>
<li><p><strong>Hypothesis 1</strong>: Punctual extreme weather events have acted as selection bottlenecks, favouring heavier individuals in the population.</p>
<ul>
<li><strong>Methodology 1</strong>: I will analyze extreme weather events occurences at the study sites and investigate their link with population fluctuations and mean body mass’ genetic values over the study period.</li>
</ul></li>
<li><p><strong>Hypothesis 2</strong>: Drought events, which have become more frequent with global warming, increase the proportion of dry vegetation, enhancing selection for larger individuals able consume a more fibrous diet due to longer Mean Retention Time (MRT) <span class="citation" data-cites="armitage2014">(<a href="#ref-armitage2014" role="doc-biblioref">Armitage 2014</a>)</span>.</p>
<ul>
<li><strong>Methodology 2</strong>: I will study marmots’ diet composition over the years to evaluate changes in vegetation quality and selection.</li>
</ul></li>
<li><p><strong>Hypothesis 3</strong>: Larger individuals will be favoured by natural selection as they are better able to fend off smaller predators such as Long-Tailed Weasels (<em>Mustela frenata</em>) and American Marten (<em>Martes americana</em>) <span class="citation" data-cites="armitage2014">(<a href="#ref-armitage2014" role="doc-biblioref">Armitage 2014</a>)</span>.</p>
<ul>
<li><strong>Methodology 3</strong>: I will examine predators population dynamics and species composition and compare that to the recorded causes of marmot mortality over the study period.</li>
</ul></li>
</ul>
<p><strong>RQ2</strong>: <em>What are the short- and long-term consequences of this shift in a Life-History Trait (LHT)?</em></p>
<ul>
<li><p><strong>Hypothesis 4</strong>: A significant shift in body mass, combined with environmental changes, will alter the life cycle of this hibernating species.</p>
<ul>
<li><strong>Methodology 4</strong>: I will investigate changes in the active season/hibernation length balance and examine potential correlations with body mass and environmental factors.</li>
</ul></li>
<li><p><strong>Hypothesis 5</strong>: A shift in body condition will result in behavioural changes at the individual level.</p>
<ul>
<li><strong>Methodology 5</strong>: I will assess changes in individual behavior by analysing boldness data collected through Flight Initiation Distance (FID) experiments over the study period and test for link with body mass.</li>
</ul></li>
</ul>
<p><strong>Significance and Impact</strong>: This research uses one of the most extensive natural population databases in the world to deepen our understanding of the genotype-phenotype-environment relationship. This work will provide crucial insights into how wild populations adapt to changing environments. These findings will contribute valuable knowledge to the field of conservation biology, helping shape more effective conservation policies in the context of global climate change.</p>
<div style="page-break-after: always;"></div>
<section id="references" class="level4">
<h4 class="anchored" data-anchor-id="references">References</h4>
<div class="{refs}">

</div>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-armitage2014" class="csl-entry" role="listitem">
Armitage, K. B. (2014), <span>“Marmot biology.”</span> <a href="https://doi.org/10.1017/cbo9781107284272">https://doi.org/10.1017/cbo9781107284272</a>.
</div>
<div id="ref-bergmannc1847" class="csl-entry" role="listitem">
Bergmann, C (1847), <span>“About the relationships between heat conservation and body size of animals,”</span> <em>Goett Stud</em>, 1.
</div>
<div id="ref-chevin_evolution_2015" class="csl-entry" role="listitem">
Chevin, L. (2015), <span>“Evolution of adult size depends on genetic variance in growth trajectories: A comment on analyses of evolutionary dynamics using integral projection models,”</span> <em>Methods in Ecology and Evolution</em>, (S. Ramula, ed.), 6, 981–986. <a href="https://doi.org/10.1111/2041-210X.12389">https://doi.org/10.1111/2041-210X.12389</a>.
</div>
<div id="ref-darwin_origin_1859" class="csl-entry" role="listitem">
Darwin, C. (1859), <em>The <span>Origin</span> of <span>Species</span>: <span>By</span> <span>Means</span> of <span>Natural</span> <span>Selection</span>, or the <span>Preservation</span> of <span>Favoured</span> <span>Races</span> in the <span>Struggle</span> for <span>Life</span></em>, Cambridge University Press. <a href="https://doi.org/10.1017/CBO9780511694295">https://doi.org/10.1017/CBO9780511694295</a>.
</div>
<div id="ref-daufresne2009" class="csl-entry" role="listitem">
Daufresne, M., Lengfellner, K., and Sommer, U. (2009), <span>“Global warming benefits the small in aquatic ecosystems,”</span> <em>Proceedings of the National Academy of Sciences</em>, 106, 12788–12793. <a href="https://doi.org/10.1073/pnas.0902080106">https://doi.org/10.1073/pnas.0902080106</a>.
</div>
<div id="ref-gardner_declining_2011" class="csl-entry" role="listitem">
Gardner, J. L., Peters, A., Kearney, M. R., Joseph, L., and Heinsohn, R. (2011), <span>“Declining body size: A third universal response to warming?”</span> <em>Trends in Ecology &amp; Evolution</em>, 26, 285–291. <a href="https://doi.org/10.1016/j.tree.2011.03.005">https://doi.org/10.1016/j.tree.2011.03.005</a>.
</div>
<div id="ref-charmantier_evolutionary_2014-1" class="csl-entry" role="listitem">
Gienapp, P., and Brommer, J. E. (2014), <span>“Evolutionary dynamics in response to climate change,”</span> in <em>Quantitative <span>Genetics</span> in the <span>Wild</span></em>, eds. A. Charmantier, D. Garant, and L. E. B. Kruuk, Oxford University PressOxford, pp. 254–274. <a href="https://doi.org/10.1093/acprof:oso/9780199674237.003.0015">https://doi.org/10.1093/acprof:oso/9780199674237.003.0015</a>.
</div>
<div id="ref-guillemain2010" class="csl-entry" role="listitem">
Guillemain, M., Elmberg, J., Gauthier-Clerc, M., Massez, G., Hearn, R., Champagnon, J., and Simon, G. (2010), <span>“Wintering French Mallard and Teal Are Heavier and in Better Body Condition than 30 Years Ago: Effects of a Changing Environment?”</span> <em>AMBIO</em>, 39, 170–180. <a href="https://doi.org/10.1007/s13280-010-0020-9">https://doi.org/10.1007/s13280-010-0020-9</a>.
</div>
<div id="ref-hadfield_mcmc_2010" class="csl-entry" role="listitem">
Hadfield, J. D. (2010), <span>“<span>MCMC</span> <span>Methods</span> for <span>Multi</span>-<span>Response</span> <span>Generalized</span> <span>Linear</span> <span>Mixed</span> <span>Models</span>: <span>The</span> <strong>MCMCglmm</strong> <em>r</em> <span>Package</span>,”</span> <em>Journal of Statistical Software</em>, 33. <a href="https://doi.org/10.18637/jss.v033.i02">https://doi.org/10.18637/jss.v033.i02</a>.
</div>
<div id="ref-janeiro_towards_2017" class="csl-entry" role="listitem">
Janeiro, M. J., Coltman, D. W., Festa‐Bianchet, M., Pelletier, F., and Morrissey, M. B. (2017), <span>“Towards robust evolutionary inference with integral projection models,”</span> <em>Journal of Evolutionary Biology</em>, 30, 270–288. <a href="https://doi.org/10.1111/jeb.13000">https://doi.org/10.1111/jeb.13000</a>.
</div>
<div id="ref-ozgul_coupled_2010" class="csl-entry" role="listitem">
Ozgul, A., Childs, D. Z., Oli, M. K., Armitage, K. B., Blumstein, D. T., Olson, L. E., Tuljapurkar, S., and Coulson, T. (2010), <span>“Coupled dynamics of body mass and population growth in response to environmental change,”</span> <em>Nature</em>, 466, 482–485. <a href="https://doi.org/10.1038/nature09210">https://doi.org/10.1038/nature09210</a>.
</div>
<div id="ref-sheridan2011" class="csl-entry" role="listitem">
Sheridan, J. A., and Bickford, D. (2011), <span>“Shrinking body size as an ecological response to climate change,”</span> <em>Nature Climate Change</em>, 1, 401–406. <a href="https://doi.org/10.1038/nclimate1259">https://doi.org/10.1038/nclimate1259</a>.
</div>
<div id="ref-yom-tov2008" class="csl-entry" role="listitem">
Yom-Tov, Y., Yom-Tov, S., and Jarrell, G. (2008), <span>“Recent increase in body size of the American marten Martes americana in Alaska: GLOBAL WARMING AND BODY SIZE OF THE AMERICAN MARTEN,”</span> <em>Biological Journal of the Linnean Society</em>, 93, 701–707. <a href="https://doi.org/10.1111/j.1095-8312.2007.00950.x">https://doi.org/10.1111/j.1095-8312.2007.00950.x</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>